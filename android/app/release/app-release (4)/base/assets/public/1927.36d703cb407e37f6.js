"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1927],{4796:(y,b,c)=>{c.d(b,{u:()=>v});var m=c(467),u=c(9330),_=c(4412),f=c(8141),P=c(5312),U=c(2615);let v=(()=>{var d;class p{constructor(t){this.http=t,this.baseUrl=P.c.apiUrl;const o=localStorage.getItem("currentUser");this.currentUserSubject=new _.t(o?JSON.parse(o):null),this.currentUser=this.currentUserSubject.asObservable()}get currentUserValue(){return this.currentUserSubject.value}login(t,o){const a=new u.Lr({"Content-Type":"application/json"}),r={acao:"login",nome:t,senha:o};return console.log("=== LOGIN ==="),console.log("URL:",`${this.baseUrl}/b_veicular_auth.php`),console.log("Dados:",{nome:t,senha:"***"}),this.http.post(`${this.baseUrl}/b_veicular_auth.php`,r,{headers:a}).pipe((0,f.M)(n=>{console.log("Resposta do login:",n),n.sucesso&&n.usuario&&(localStorage.setItem("currentUser",JSON.stringify(n.usuario)),localStorage.setItem("authToken",n.token||""),this.currentUserSubject.next(n.usuario),console.log("Usu\xe1rio autenticado:",n.usuario))}))}logout(){var t=this;return(0,m.A)(function*(){localStorage.removeItem("currentUser"),localStorage.removeItem("authToken"),t.currentUserSubject.next(null);try{const{Preferences:o}=yield Promise.all([c.e(5083),c.e(8254)]).then(c.bind(c,8254));yield o.remove({key:"saved_nome"}),yield o.remove({key:"saved_password"}),yield o.remove({key:"remember_password"})}catch(o){console.log("Erro ao limpar credenciais no logout:",o)}console.log("Usu\xe1rio deslogado")})()}isLoggedIn(){return null!==this.currentUserValue}getAuthToken(){return localStorage.getItem("authToken")}isAdmin(){return"admin"===this.currentUserValue?.tipo_usuario}definirSenha(t,o){const a=new u.Lr({"Content-Type":"application/json"});return this.http.post(`${this.baseUrl}/b_veicular_auth.php`,{acao:"definir_senha",usuario_id:t,nova_senha:o},{headers:a})}tutorialConcluido(){const t=this.currentUserValue;return!t||t.tutorial_concluido}marcarTutorialConcluido(){const t=this.currentUserValue;if(!t)throw new Error("Usu\xe1rio n\xe3o autenticado");const o=new u.Lr({"Content-Type":"application/json"});return this.http.post(`${this.baseUrl}/b_veicular_auth.php`,{acao:"marcar_tutorial_concluido",usuario_id:t.id},{headers:o}).pipe((0,f.M)(r=>{console.log("Tutorial marcado como conclu\xeddo:",r),t&&(t.tutorial_concluido=!0,localStorage.setItem("currentUser",JSON.stringify(t)),this.currentUserSubject.next(t))}))}static#e=d=()=>(this.\u0275fac=function(o){return new(o||p)(U.KVO(u.Qq))},this.\u0275prov=U.jDH({token:p,factory:p.\u0275fac,providedIn:"root"}))}return d(),p})()},5312:(y,b,c)=>{c.d(b,{c:()=>m});const m={production:!0,apiUrl:"https://floripa.in9automacao.com.br"}},6386:(y,b,c)=>{c.d(b,{G:()=>U});var m=c(467),u=c(9330),_=c(5312),f=c(2615);let P=(()=>{var v;class d{constructor(){}compressPhoto(e){var t=this;return(0,m.A)(function*(o,a=1200,r=.8){return new Promise((n,s)=>{try{o.split(",");const h=new Image;h.onload=()=>{try{let{width:g,height:i}=t.calculateDimensions(h.width,h.height,a);const E=document.createElement("canvas"),I=E.getContext("2d");if(!I)return void s(new Error("N\xe3o foi poss\xedvel criar contexto do canvas"));E.width=g,E.height=i,I.drawImage(h,0,0,g,i);const C=E.toDataURL("image/jpeg",r);console.log(`Foto comprimida: ${o.length} -> ${C.length} caracteres`),n(C)}catch(g){s(g)}},h.onerror=()=>{s(new Error("Erro ao carregar a imagem"))},h.src=o}catch(l){s(l)}})}).apply(this,arguments)}calculateDimensions(e,t,o){return e<=o?{width:e,height:t}:{width:o,height:Math.round(t*(o/e))}}compressAllPhotos(e){var t=this;return(0,m.A)(function*(){const o={...e},a=["fotoKmInicial","fotoCombustivel","fotoPainel","motorAguaRadiadorFoto","motorAguaParabrisaFoto","motorFluidoFreioFoto","motorNivelOleoFoto","motorTampaReservatorioFoto","motorTampaRadiadorFoto","limpezaInternaFoto","limpezaExternaFoto","fotoFrontal","fotoTraseira","fotoLateralDireita","fotoLateralEsquerda","pneuDianteiraDireitaFoto","pneuDianteiraEsquerdaFoto","pneuTraseiraDireitaFoto","pneuTraseiraEsquerdaFoto","pneuEstepeFoto"];for(const r of a)if(o[r]&&"string"==typeof o[r])try{o[r]=yield t.compressPhoto(o[r])}catch(n){console.warn(`Erro ao comprimir foto ${r}:`,n)}return o})()}static#e=v=()=>(this.\u0275fac=function(t){return new(t||d)},this.\u0275prov=f.jDH({token:d,factory:d.\u0275fac,providedIn:"root"}))}return v(),d})(),U=(()=>{var v;class d{constructor(e,t){this.http=e,this.photoCompression=t,this.baseUrl=_.c.apiUrl}testarConexao(){return this.http.get(`${this.baseUrl}/b_veicular_get.php?acao=todos&limite=1`)}testarConexaoSimples(){return this.http.get(`${this.baseUrl}/test_connection.php`)}salvarChecklist(e){const t=new u.Lr({"Content-Type":"application/json"});return console.log("=== SALVANDO CHECKLIST ==="),console.log("URL:",`${this.baseUrl}/b_veicular_set.php`),console.log("Headers:",t),console.log("Dados:",e),console.log("Tamanho dos dados:",JSON.stringify(e).length,"bytes"),this.http.post(`${this.baseUrl}/b_veicular_set.php`,e,{headers:t})}criarInspecaoInicial(e){const t=new u.Lr({"Content-Type":"application/json"});return console.log("=== CRIANDO INSPE\xc7\xc3O INICIAL ==="),console.log("URL:",`${this.baseUrl}/b_veicular_set.php`),console.log("Dados:",e),this.http.post(`${this.baseUrl}/b_veicular_set.php`,e,{headers:t})}atualizarInspecao(e,t){const o=new u.Lr({"Content-Type":"application/json"}),a={inspecao_id:e,...t};return console.log("=== ATUALIZANDO INSPE\xc7\xc3O ==="),console.log("URL:",`${this.baseUrl}/b_veicular_update.php`),console.log("Dados:",a),this.http.post(`${this.baseUrl}/b_veicular_update.php`,a,{headers:o})}salvarChecklistSimples(e){var t=this;return(0,m.A)(function*(){console.log("=== COMPRIMINDO FOTOS ===");const o=yield t.photoCompression.compressAllPhotos(e),a=t.transformarParaApiFormat(o);return console.log("Fotos comprimidas com sucesso"),t.salvarChecklist(a)})()}buscarTodos(e=100){return this.http.get(`${this.baseUrl}/b_veicular_get.php?acao=todos&limite=${e}`)}buscarPorPlaca(e){return this.http.get(`${this.baseUrl}/b_veicular_get.php?acao=placa&placa=${e}`)}buscarPorId(e){return this.http.get(`${this.baseUrl}/b_veicular_get.php?acao=id&id=${e}`)}buscarCompleto(e){return this.http.get(`${this.baseUrl}/b_veicular_get.php?acao=completo&id=${e}`)}buscarPorPeriodo(e,t){return this.http.get(`${this.baseUrl}/b_veicular_get.php?acao=periodo&data_inicio=${e}&data_fim=${t}`)}salvarChecklistCompleto(e){const t=new u.Lr({"Content-Type":"application/json"});return console.log("=== SALVANDO CHECKLIST COMPLETO ==="),console.log("URL:",`${this.baseUrl}/b_checklist_completo_set.php`),console.log("Dados:",e),this.http.post(`${this.baseUrl}/b_checklist_completo_set.php`,e,{headers:t})}buscarChecklistCompleto(e){return this.http.get(`${this.baseUrl}/b_checklist_completo_get.php?acao=id&id=${e}`)}buscarChecklistsCompletos(e=100){return this.http.get(`${this.baseUrl}/b_checklist_completo_get.php?acao=todos&limite=${e}`)}buscarChecklistCompletosPorPlaca(e){return this.http.get(`${this.baseUrl}/b_checklist_completo_get.php?acao=placa&placa=${e}`)}buscarChecklistCompletosPorPeriodo(e,t){return this.http.get(`${this.baseUrl}/b_checklist_completo_get.php?acao=periodo&data_inicio=${e}&data_fim=${t}`)}transformarParaApiFormat(e){const t=e.inspecaoInicial,o=e.inspecaoVeiculo,a=e.fotosVeiculo||[],r=e.pneus||[];console.log("=== TRANSFORMANDO DADOS DINAMICAMENTE ==="),console.log("Checklist completo:",e);const n=[];(o?.motor||[]).forEach(i=>{n.push({categoria:"MOTOR",item:i.nome,status:i.valor,foto:i.foto||null})}),(o?.eletricos||[]).forEach(i=>{n.push({categoria:"ELETRICO",item:i.nome,status:i.valor,foto:i.foto||null})}),(o?.limpeza||[]).forEach(i=>{n.push({categoria:"LIMPEZA",item:i.nome,status:i.valor,foto:i.foto||null})}),(o?.ferramentas||[]).forEach(i=>{n.push({categoria:"FERRAMENTA",item:i.nome,status:i.valor,foto:i.foto||null})});const s=[];r.forEach(i=>{s.push({item:i.nome,status:i.valor,foto:i.foto||null,pressao:i.pressao||null,foto_caneta:i.fotoCaneta||null})});const l={},h={"Foto Frontal":"foto_frontal","Foto Traseira":"foto_traseira","Foto Lateral Direita":"foto_lateral_direita","Foto Lateral Esquerda":"foto_lateral_esquerda"};a.forEach(i=>{const E=h[i.tipo];E&&(l[E]=i.foto||"")}),console.log("Total de itens de inspe\xe7\xe3o:",n.length),console.log("Total de pneus:",s.length),console.log("Fotos mapeadas:",Object.keys(l));const g={placa:t?.placa||"",km_inicial:t?.kmInicial||0,nivel_combustivel:t?.nivelCombustivel||"0%",foto_painel:t?.fotoPainel||"",observacao_painel:t?.observacaoPainel||"",usuario_id:e.usuario_id||null,itens_inspecao:n,itens_pneus:s,...l};return console.log("=== DADOS FINAIS DIN\xc2MICOS PARA ENVIO ==="),console.log("Itens de inspe\xe7\xe3o:",g.itens_inspecao.length),console.log("Itens de pneus:",g.itens_pneus.length),console.log("Dados completos:",g),g}static#e=v=()=>(this.\u0275fac=function(t){return new(t||d)(f.KVO(u.Qq),f.KVO(P))},this.\u0275prov=f.jDH({token:d,factory:d.\u0275fac,providedIn:"root"}))}return v(),d})()},7691:(y,b,c)=>{c.d(b,{i7:()=>d,LK:()=>P,ru:()=>_});var m=c(5083),u=c(467),_=function(p){return p.Prompt="PROMPT",p.Camera="CAMERA",p.Photos="PHOTOS",p}(_||{}),f=function(p){return p.Rear="REAR",p.Front="FRONT",p}(f||{}),P=function(p){return p.Uri="uri",p.Base64="base64",p.DataUrl="dataUrl",p}(P||{});class U extends m.E_{getPhoto(e){var t=this;return(0,u.A)(function*(){return new Promise(function(){var o=(0,u.A)(function*(a,r){if(e.webUseInput||e.source===_.Photos)t.fileInputExperience(e,a,r);else if(e.source===_.Prompt){let n=document.querySelector("pwa-action-sheet");n||(n=document.createElement("pwa-action-sheet"),document.body.appendChild(n)),n.header=e.promptLabelHeader||"Photo",n.cancelable=!1,n.options=[{title:e.promptLabelPhoto||"From Photos"},{title:e.promptLabelPicture||"Take Picture"}],n.addEventListener("onSelection",function(){var s=(0,u.A)(function*(l){0===l.detail?t.fileInputExperience(e,a,r):t.cameraExperience(e,a,r)});return function(l){return s.apply(this,arguments)}}())}else t.cameraExperience(e,a,r)});return function(a,r){return o.apply(this,arguments)}}())})()}pickImages(e){var t=this;return(0,u.A)(function*(){return new Promise(function(){var o=(0,u.A)(function*(a,r){t.multipleFileInputExperience(a,r)});return function(a,r){return o.apply(this,arguments)}}())})()}cameraExperience(e,t,o){var a=this;return(0,u.A)(function*(){if(customElements.get("pwa-camera-modal")){const r=document.createElement("pwa-camera-modal");r.facingMode=e.direction===f.Front?"user":"environment",document.body.appendChild(r);try{yield r.componentOnReady(),r.addEventListener("onPhoto",function(){var n=(0,u.A)(function*(s){const l=s.detail;null===l?o(new m.I9("User cancelled photos app")):l instanceof Error?o(l):t(yield a._getCameraPhoto(l,e)),r.dismiss(),document.body.removeChild(r)});return function(s){return n.apply(this,arguments)}}()),r.present()}catch{a.fileInputExperience(e,t,o)}}else console.error("Unable to load PWA Element 'pwa-camera-modal'. See the docs: https://capacitorjs.com/docs/web/pwa-elements."),a.fileInputExperience(e,t,o)})()}fileInputExperience(e,t,o){let a=document.querySelector("#_capacitor-camera-input");const r=()=>{var n;null===(n=a.parentNode)||void 0===n||n.removeChild(a)};a||(a=document.createElement("input"),a.id="_capacitor-camera-input",a.type="file",a.hidden=!0,document.body.appendChild(a),a.addEventListener("change",n=>{const s=a.files[0];let l="jpeg";if("image/png"===s.type?l="png":"image/gif"===s.type&&(l="gif"),"dataUrl"===e.resultType||"base64"===e.resultType){const h=new FileReader;h.addEventListener("load",()=>{if("dataUrl"===e.resultType)t({dataUrl:h.result,format:l});else if("base64"===e.resultType){const g=h.result.split(",")[1];t({base64String:g,format:l})}r()}),h.readAsDataURL(s)}else t({webPath:URL.createObjectURL(s),format:l}),r()}),a.addEventListener("cancel",n=>{o(new m.I9("User cancelled photos app")),r()})),a.accept="image/*",a.capture=!0,e.source===_.Photos||e.source===_.Prompt?a.removeAttribute("capture"):e.direction===f.Front?a.capture="user":e.direction===f.Rear&&(a.capture="environment"),a.click()}multipleFileInputExperience(e,t){let o=document.querySelector("#_capacitor-camera-input-multiple");const a=()=>{var r;null===(r=o.parentNode)||void 0===r||r.removeChild(o)};o||(o=document.createElement("input"),o.id="_capacitor-camera-input-multiple",o.type="file",o.hidden=!0,o.multiple=!0,document.body.appendChild(o),o.addEventListener("change",r=>{const n=[];for(let s=0;s<o.files.length;s++){const l=o.files[s];let h="jpeg";"image/png"===l.type?h="png":"image/gif"===l.type&&(h="gif"),n.push({webPath:URL.createObjectURL(l),format:h})}e({photos:n}),a()}),o.addEventListener("cancel",r=>{t(new m.I9("User cancelled photos app")),a()})),o.accept="image/*",o.click()}_getCameraPhoto(e,t){return new Promise((o,a)=>{const r=new FileReader,n=e.type.split("/")[1];"uri"===t.resultType?o({webPath:URL.createObjectURL(e),format:n,saved:!1}):(r.readAsDataURL(e),r.onloadend=()=>{const s=r.result;o("dataUrl"===t.resultType?{dataUrl:s,format:n,saved:!1}:{base64String:s.split(",")[1],format:n,saved:!1})},r.onerror=s=>{a(s)})})}checkPermissions(){var e=this;return(0,u.A)(function*(){if(typeof navigator>"u"||!navigator.permissions)throw e.unavailable("Permissions API not available in this browser");try{return{camera:(yield window.navigator.permissions.query({name:"camera"})).state,photos:"granted"}}catch{throw e.unavailable("Camera permissions are not available in this browser")}})()}requestPermissions(){var e=this;return(0,u.A)(function*(){throw e.unimplemented("Not implemented on web.")})()}pickLimitedLibraryPhotos(){var e=this;return(0,u.A)(function*(){throw e.unavailable("Not implemented on web.")})()}getLimitedLibraryPhotos(){var e=this;return(0,u.A)(function*(){throw e.unavailable("Not implemented on web.")})()}}new U;const d=(0,m.F3)("Camera",{web:()=>new U})}}]);