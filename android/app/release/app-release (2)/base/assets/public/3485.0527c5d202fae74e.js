"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3485],{3485:(O,v,t)=>{t.r(v),t.d(v,{LoginPageModule:()=>p});var y=t(2200),g=t(4341),u=t(7343),C=t(8132),d=t(467),e=t(3664),x=t(4796),M=t(4192);let h=(()=>{var m;class s{constructor(n,o,i,r){this.authService=n,this.router=o,this.alertController=i,this.loadingController=r,this.nome="",this.senha="",this.mostrarSenha=!1,this.lembrarSenha=!1}ngOnInit(){var n=this;return(0,d.A)(function*(){n.authService.isLoggedIn()?n.authService.isAdmin()?n.router.navigate(["/admin"]):n.router.navigate(["/home"]):yield n.carregarCredenciaisSalvas()})()}carregarCredenciaisSalvas(){var n=this;return(0,d.A)(function*(){try{const{Preferences:o}=yield Promise.all([t.e(5083),t.e(8254)]).then(t.bind(t,8254)),{value:i}=yield o.get({key:"saved_nome"}),{value:r}=yield o.get({key:"saved_password"}),{value:a}=yield o.get({key:"remember_password"});"true"===a&&i&&r&&(n.nome=i,n.senha=r,n.lembrarSenha=!0)}catch(o){console.log("Erro ao carregar credenciais salvas:",o)}})()}salvarCredenciais(){var n=this;return(0,d.A)(function*(){try{const{Preferences:o}=yield Promise.all([t.e(5083),t.e(8254)]).then(t.bind(t,8254));n.lembrarSenha?(yield o.set({key:"saved_nome",value:n.nome}),yield o.set({key:"saved_password",value:n.senha}),yield o.set({key:"remember_password",value:"true"})):yield n.limparCredenciais()}catch(o){console.log("Erro ao salvar credenciais:",o)}})()}limparCredenciais(){return(0,d.A)(function*(){try{const{Preferences:n}=yield Promise.all([t.e(5083),t.e(8254)]).then(t.bind(t,8254));yield n.remove({key:"saved_nome"}),yield n.remove({key:"saved_password"}),yield n.remove({key:"remember_password"})}catch(n){console.log("Erro ao limpar credenciais:",n)}})()}toggleMostrarSenha(){this.mostrarSenha=!this.mostrarSenha}login(){var n=this;return(0,d.A)(function*(){if(!n.nome)return void(yield n.mostrarAlerta("Erro","Por favor, preencha o nome de usu\xe1rio."));const o=yield n.loadingController.create({message:"Autenticando...",spinner:"crescent"});var i;yield o.present(),n.authService.login(n.nome,n.senha).subscribe({next:(i=(0,d.A)(function*(r){yield o.dismiss(),r.precisa_criar_senha&&r.usuario?yield n.mostrarModalCriarSenha(r.usuario):r.sucesso?(console.log("Login bem-sucedido!"),yield n.salvarCredenciais(),"admin"===r.usuario?.tipo_usuario?(console.log("Redirecionando para tela de admin..."),n.router.navigate(["/admin"])):(console.log("Redirecionando para tela de checklist..."),n.router.navigate(["/home"]))):yield n.mostrarAlerta("Erro de Login",r.mensagem||"Nome de usu\xe1rio ou senha inv\xe1lidos.")}),function(a){return i.apply(this,arguments)}),error:function(){var i=(0,d.A)(function*(r){yield o.dismiss(),console.error("Erro no login:",r),console.error("Status:",r.status),console.error("Error object:",r.error),console.error("Error text:",r.error?.text),console.error("Response type:",typeof r.error);let a="N\xe3o foi poss\xedvel conectar ao servidor. Verifique sua conex\xe3o.";r.error?.mensagem?a=r.error.mensagem:0===r.status?a="N\xe3o foi poss\xedvel conectar ao servidor. Verifique sua conex\xe3o com a internet.":404===r.status?a="Servidor n\xe3o encontrado. Verifique a URL da API.":200===r.status&&(a="Erro ao processar resposta do servidor. Corpo da resposta: "+JSON.stringify(r.error)),yield n.mostrarAlerta("Erro",a)});return function(a){return i.apply(this,arguments)}}()})})()}mostrarAlerta(n,o){var i=this;return(0,d.A)(function*(){yield(yield i.alertController.create({header:n,message:o,buttons:["OK"]})).present()})()}validarFormulario(){return!!(this.nome&&this.nome.length>0)}mostrarModalCriarSenha(n){var o=this;return(0,d.A)(function*(){var r;yield(yield o.alertController.create({header:"Criar Senha",message:`Ol\xe1, ${n.nome}! Voc\xea precisa criar uma senha para acessar o sistema.`,inputs:[{name:"novaSenha",type:"password",placeholder:"Digite sua nova senha",attributes:{minlength:4}},{name:"confirmarSenha",type:"password",placeholder:"Confirme sua senha",attributes:{minlength:4}}],buttons:[{text:"Cancelar",role:"cancel"},{text:"Criar Senha",handler:(r=(0,d.A)(function*(a){if(!a.novaSenha||a.novaSenha.length<4)return yield o.mostrarAlerta("Erro","A senha deve ter no m\xednimo 4 caracteres."),!1;if(a.novaSenha!==a.confirmarSenha)return yield o.mostrarAlerta("Erro","As senhas n\xe3o coincidem."),!1;const P=yield o.loadingController.create({message:"Criando senha...",spinner:"crescent"});return yield P.present(),o.authService.definirSenha(n.id,a.novaSenha).subscribe({next:(b=(0,d.A)(function*(f){yield P.dismiss(),f.sucesso?(yield o.mostrarAlerta("Sucesso",f.mensagem),o.senha=""):yield o.mostrarAlerta("Erro",f.mensagem)}),function(E){return b.apply(this,arguments)}),error:function(){var b=(0,d.A)(function*(f){yield P.dismiss(),console.error("Erro ao criar senha:",f),yield o.mostrarAlerta("Erro","N\xe3o foi poss\xedvel criar a senha. Tente novamente.")});return function(E){return b.apply(this,arguments)}}()}),!0;var b}),function(P){return r.apply(this,arguments)})}]})).present()})()}static#e=m=()=>(this.\u0275fac=function(o){return new(o||s)(e.rXU(x.u),e.rXU(M.Ix),e.rXU(u.hG),e.rXU(u.Xi))},this.\u0275cmp=e.VBU({type:s,selectors:[["app-login"]],standalone:!1,decls:31,vars:7,consts:[["color","dark",3,"fullscreen"],[1,"login-container"],[1,"login-header"],["src","assets/img/logo.png","alt","i9 Checklist",1,"logo-img"],[1,"login-card"],["lines","full"],["label","Nome de Usu\xe1rio","labelPlacement","floating","type","text","placeholder","Digite seu nome de usu\xe1rio","name","nome","autocomplete","username",3,"ngModelChange","ngModel"],["label","Senha","labelPlacement","floating","placeholder","Digite sua senha","name","senha","autocomplete","current-password",3,"ngModelChange","type","ngModel"],["fill","clear","slot","end",3,"click"],["slot","icon-only",3,"name"],["lines","none",1,"checkbox-item"],["slot","start","name","lembrarSenha",3,"ngModelChange","ngModel"],["expand","block","size","large","color","primary",1,"login-button",3,"click","disabled"],["slot","start","name","log-in-outline"],[1,"login-info"],["name","information-circle-outline"],[1,"login-footer"]],template:function(o,i){1&o&&(e.j41(0,"ion-content",0)(1,"div",1)(2,"div",2),e.nrm(3,"img",3),e.j41(4,"h1"),e.EFF(5,"i9 Checklist"),e.k0s(),e.j41(6,"p"),e.EFF(7,"Inspe\xe7\xe3o Veicular"),e.k0s()(),e.j41(8,"ion-card",4)(9,"ion-card-content")(10,"form")(11,"ion-item",5)(12,"ion-input",6),e.mxI("ngModelChange",function(a){return e.DH7(i.nome,a)||(i.nome=a),a}),e.k0s()(),e.j41(13,"ion-item",5)(14,"ion-input",7),e.mxI("ngModelChange",function(a){return e.DH7(i.senha,a)||(i.senha=a),a}),e.k0s(),e.j41(15,"ion-button",8),e.bIt("click",function(){return i.toggleMostrarSenha()}),e.nrm(16,"ion-icon",9),e.k0s()(),e.j41(17,"ion-item",10)(18,"ion-checkbox",11),e.mxI("ngModelChange",function(a){return e.DH7(i.lembrarSenha,a)||(i.lembrarSenha=a),a}),e.k0s(),e.j41(19,"ion-label"),e.EFF(20,"Lembrar senha"),e.k0s()(),e.j41(21,"ion-button",12),e.bIt("click",function(){return i.login()}),e.nrm(22,"ion-icon",13),e.EFF(23," Entrar "),e.k0s()(),e.j41(24,"div",14)(25,"p"),e.nrm(26,"ion-icon",15),e.EFF(27," Entre com suas credenciais para acessar o sistema "),e.k0s()()()(),e.j41(28,"div",16)(29,"p"),e.EFF(30,"Checklist App v1.0"),e.k0s()()()()),2&o&&(e.Y8G("fullscreen",!0),e.R7$(12),e.R50("ngModel",i.nome),e.R7$(2),e.Y8G("type",i.mostrarSenha?"text":"password"),e.R50("ngModel",i.senha),e.R7$(2),e.Y8G("name",i.mostrarSenha?"eye-off-outline":"eye-outline"),e.R7$(2),e.R50("ngModel",i.lembrarSenha),e.R7$(3),e.Y8G("disabled",!i.validarFormulario()))},dependencies:[g.qT,g.BC,g.cb,g.vS,g.cV,u.Jm,u.b_,u.I9,u.eY,u.W9,u.iq,u.$w,u.uz,u.he,u.hB,u.Gw],styles:[".login-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;min-height:100vh;padding:20px}.login-header[_ngcontent-%COMP%]{text-align:center;margin-bottom:30px}.login-header[_ngcontent-%COMP%]   .logo-img[_ngcontent-%COMP%]{width:120px;height:120px;margin-bottom:10px;object-fit:contain}.login-header[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:80px;margin-bottom:10px}.login-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:32px;font-weight:700;margin:10px 0;color:var(--ion-color-primary)}.login-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px;color:var(--ion-color-medium);margin:5px 0}.login-card[_ngcontent-%COMP%]{width:100%;max-width:400px;box-shadow:0 4px 6px #0000004d}.login-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]{padding:20px}ion-item[_ngcontent-%COMP%]{margin-bottom:15px;--background: transparent;--border-color: var(--ion-color-medium)}ion-item[_ngcontent-%COMP%]:last-of-type{margin-bottom:20px}.checkbox-item[_ngcontent-%COMP%]{margin-top:10px;margin-bottom:10px}.checkbox-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin-left:10px;color:var(--ion-color-medium);font-size:14px}.checkbox-item[_ngcontent-%COMP%]   ion-checkbox[_ngcontent-%COMP%]{--size: 20px;--checkbox-background-checked: var(--ion-color-primary)}.login-button[_ngcontent-%COMP%]{margin-top:20px;height:50px;font-size:18px;font-weight:700}.login-info[_ngcontent-%COMP%]{margin-top:20px;text-align:center}.login-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:8px;font-size:14px;color:var(--ion-color-medium);margin:0}.login-info[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:18px}.login-footer[_ngcontent-%COMP%]{margin-top:30px;text-align:center}.login-footer[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:12px;color:var(--ion-color-medium)}@media (max-width: 576px){.login-header[_ngcontent-%COMP%]   .logo-img[_ngcontent-%COMP%]{width:90px;height:90px}.login-header[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:60px}.login-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:24px}.login-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]{padding:15px}}"]}))}return m(),s})();var S=t(2615);const l=[{path:"",component:h}];let c=(()=>{var m;class s{static#e=m=()=>(this.\u0275fac=function(o){return new(o||s)},this.\u0275mod=e.$C({type:s}),this.\u0275inj=S.G2t({imports:[C.iI.forChild(l),C.iI]}))}return m(),s})(),p=(()=>{var m;class s{static#e=m=()=>(this.\u0275fac=function(o){return new(o||s)},this.\u0275mod=e.$C({type:s}),this.\u0275inj=S.G2t({imports:[y.MD,g.YN,u.bv,c]}))}return m(),s})()},4796:(O,v,t)=>{t.d(v,{u:()=>x});var y=t(467),g=t(9330),u=t(4412),C=t(8141),d=t(5312),e=t(2615);let x=(()=>{var M;class h{constructor(l){this.http=l,this.baseUrl=d.c.apiUrl;const c=localStorage.getItem("currentUser");this.currentUserSubject=new u.t(c?JSON.parse(c):null),this.currentUser=this.currentUserSubject.asObservable()}get currentUserValue(){return this.currentUserSubject.value}login(l,c){const p=new g.Lr({"Content-Type":"application/json"}),m={acao:"login",nome:l,senha:c};return console.log("=== LOGIN ==="),console.log("URL:",`${this.baseUrl}/veicular_auth.php`),console.log("Dados:",{nome:l,senha:"***"}),this.http.post(`${this.baseUrl}/veicular_auth.php`,m,{headers:p}).pipe((0,C.M)(s=>{console.log("Resposta do login:",s),s.sucesso&&s.usuario&&(localStorage.setItem("currentUser",JSON.stringify(s.usuario)),localStorage.setItem("authToken",s.token||""),this.currentUserSubject.next(s.usuario),console.log("Usu\xe1rio autenticado:",s.usuario))}))}logout(){var l=this;return(0,y.A)(function*(){localStorage.removeItem("currentUser"),localStorage.removeItem("authToken"),l.currentUserSubject.next(null);try{const{Preferences:c}=yield Promise.all([t.e(5083),t.e(8254)]).then(t.bind(t,8254));yield c.remove({key:"saved_nome"}),yield c.remove({key:"saved_password"}),yield c.remove({key:"remember_password"})}catch(c){console.log("Erro ao limpar credenciais no logout:",c)}console.log("Usu\xe1rio deslogado")})()}isLoggedIn(){return null!==this.currentUserValue}getAuthToken(){return localStorage.getItem("authToken")}isAdmin(){return"admin"===this.currentUserValue?.tipo_usuario}definirSenha(l,c){const p=new g.Lr({"Content-Type":"application/json"});return this.http.post(`${this.baseUrl}/veicular_auth.php`,{acao:"definir_senha",usuario_id:l,nova_senha:c},{headers:p})}tutorialConcluido(){const l=this.currentUserValue;return!l||l.tutorial_concluido}marcarTutorialConcluido(){const l=this.currentUserValue;if(!l)throw new Error("Usu\xe1rio n\xe3o autenticado");const c=new g.Lr({"Content-Type":"application/json"});return this.http.post(`${this.baseUrl}/veicular_auth.php`,{acao:"marcar_tutorial_concluido",usuario_id:l.id},{headers:c}).pipe((0,C.M)(m=>{console.log("Tutorial marcado como conclu\xeddo:",m),l&&(l.tutorial_concluido=!0,localStorage.setItem("currentUser",JSON.stringify(l)),this.currentUserSubject.next(l))}))}static#e=M=()=>(this.\u0275fac=function(c){return new(c||h)(e.KVO(g.Qq))},this.\u0275prov=e.jDH({token:h,factory:h.\u0275fac,providedIn:"root"}))}return M(),h})()},5312:(O,v,t)=>{t.d(v,{c:()=>y});const y={production:!0,apiUrl:"https://floripa.in9automacao.com.br"}}}]);