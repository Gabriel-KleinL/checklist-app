<ion-header [translucent]="true">
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-button (click)="voltar()">
        <ion-icon slot="icon-only" name="arrow-back"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>Painel Administrativo</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="carregarChecklists()">
        <ion-icon slot="icon-only" name="refresh"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" color="light">
  <ion-header collapse="condense">
    <ion-toolbar color="primary">
      <ion-title size="large">Admin</ion-title>
    </ion-toolbar>
  </ion-header>

  <!-- Pull to Refresh -->
  <ion-refresher slot="fixed" (ionRefresh)="recarregar($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <div class="content-container">
    <!-- Sele√ß√£o de Tipo de Checklist -->
    <ion-card class="tipo-checklist-card">
      <ion-card-content>
        <ion-segment [(ngModel)]="tipoChecklistSelecionado" (ionChange)="mudarTipoChecklist(tipoChecklistSelecionado)"
          mode="md">
          <ion-segment-button value="simples">
            <ion-icon name="checkmark-circle-outline"></ion-icon>
            <ion-label>Checklist Simples</ion-label>
          </ion-segment-button>
          <ion-segment-button value="completo">
            <ion-icon name="clipboard-outline"></ion-icon>
            <ion-label>Checklist Completo</ion-label>
          </ion-segment-button>
        </ion-segment>
      </ion-card-content>
    </ion-card>

    <!-- Bot√£o de Acesso ao Checklist Completo (Criar Novo) -->
    <ion-card color="success" *ngIf="tipoChecklistSelecionado === 'completo'">
      <ion-card-content>
        <ion-button expand="block" fill="solid" color="light" routerLink="/checklist-completo">
          <ion-icon slot="start" name="add-circle"></ion-icon>
          Criar Novo Checklist Completo
        </ion-button>
      </ion-card-content>
    </ion-card>

    <!-- Segmentos (Abas) -->
    <ion-segment [(ngModel)]="abaSelecionada" (ionChange)="mudarAba(abaSelecionada)">
      <ion-segment-button value="historico">
        <ion-label>Hist√≥rico</ion-label>
        <ion-icon name="list"></ion-icon>
      </ion-segment-button>
      <ion-segment-button value="anomalias">
        <ion-label>Anomalias</ion-label>
        <ion-icon name="warning"></ion-icon>
      </ion-segment-button>
      <ion-segment-button value="metricas">
        <ion-label>M√©tricas</ion-label>
        <ion-icon name="analytics"></ion-icon>
      </ion-segment-button>
      <ion-segment-button value="configuracao">
        <ion-label>Configurar Itens</ion-label>
        <ion-icon name="settings"></ion-icon>
      </ion-segment-button>
    </ion-segment>

    <!-- ========================================= -->
    <!-- ABA: HIST√ìRICO -->
    <!-- ========================================= -->
    <div *ngIf="abaSelecionada === 'historico'">
      <!-- Estat√≠sticas - Checklist Simples -->
      <div class="stats-container animate-in-left" *ngIf="tipoChecklistSelecionado === 'simples'">
        <ion-card class="stat-card">
          <ion-card-content>
            <ion-icon name="document-text" color="primary"></ion-icon>
            <h2>{{ totalChecklists }}</h2>
            <p>Total</p>
          </ion-card-content>
        </ion-card>

        <ion-card class="stat-card">
          <ion-card-content>
            <ion-icon name="today" color="success"></ion-icon>
            <h2>{{ checklistsHoje }}</h2>
            <p>Hoje</p>
          </ion-card-content>
        </ion-card>

        <ion-card class="stat-card">
          <ion-card-content>
            <ion-icon name="calendar" color="warning"></ion-icon>
            <h2>{{ checklistsSemana }}</h2>
            <p>7 Dias</p>
          </ion-card-content>
        </ion-card>
      </div>

      <!-- Estat√≠sticas - Checklist Completo -->
      <div class="stats-container animate-in-right" *ngIf="tipoChecklistSelecionado === 'completo'">
        <ion-card class="stat-card">
          <ion-card-content>
            <ion-icon name="document-text" color="primary"></ion-icon>
            <h2>{{ totalChecklistsCompletos }}</h2>
            <p>Total</p>
          </ion-card-content>
        </ion-card>

        <ion-card class="stat-card">
          <ion-card-content>
            <ion-icon name="today" color="success"></ion-icon>
            <h2>{{ checklistsCompletosHoje }}</h2>
            <p>Hoje</p>
          </ion-card-content>
        </ion-card>

        <ion-card class="stat-card">
          <ion-card-content>
            <ion-icon name="calendar" color="warning"></ion-icon>
            <h2>{{ checklistsCompletosSemana }}</h2>
            <p>7 Dias</p>
          </ion-card-content>
        </ion-card>
      </div>

      <!-- Filtros -->
      <ion-card>
        <ion-card-header>
          <ion-card-title>Filtros</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <!-- Busca por Placa -->
          <ion-searchbar placeholder="Buscar por placa" [(ngModel)]="filtroPlaca" (ionInput)="buscarPorPlaca($event)"
            debounce="500"></ion-searchbar>

          <!-- Filtro de Data -->
          <ion-item>
            <ion-label position="stacked">Data Inicial</ion-label>
            <ion-input type="date" [(ngModel)]="filtroDataInicio" (ionChange)="aplicarFiltros()"></ion-input>
          </ion-item>

          <ion-item>
            <ion-label position="stacked">Data Final</ion-label>
            <ion-input type="date" [(ngModel)]="filtroDataFim" (ionChange)="aplicarFiltros()"></ion-input>
          </ion-item>

          <ion-button expand="block" fill="outline" color="medium" (click)="limparFiltros()" class="clear-filters-btn">
            <ion-icon slot="start" name="close-circle"></ion-icon>
            Limpar Filtros
          </ion-button>
        </ion-card-content>
      </ion-card>

      <!-- Loading -->
      <div *ngIf="carregando" class="loading-container">
        <ion-spinner name="crescent" color="primary"></ion-spinner>
        <p>Carregando checklists...</p>
      </div>

      <!-- Erro -->
      <ion-card *ngIf="erro && !carregando" color="danger">
        <ion-card-content>
          <ion-icon name="alert-circle"></ion-icon>
          {{ erro }}
        </ion-card-content>
      </ion-card>

      <!-- Resultados - Checklist Simples -->
      <ion-card *ngIf="!carregando && !erro && tipoChecklistSelecionado === 'simples'">
        <ion-card-header>
          <ion-card-title>
            Checklists Simples ({{ checklistsFiltrados.length }})
          </ion-card-title>
        </ion-card-header>
      </ion-card>

      <!-- Resultados - Checklist Completo -->
      <ion-card *ngIf="!carregando && !erro && tipoChecklistSelecionado === 'completo'">
        <ion-card-header>
          <ion-card-title>
            Checklists Completos ({{ checklistsCompletosFiltrados.length }})
          </ion-card-title>
        </ion-card-header>
      </ion-card>

      <!-- Lista vazia - Simples -->
      <div *ngIf="!carregando && !erro && tipoChecklistSelecionado === 'simples' && checklistsFiltrados.length === 0"
        class="empty-state animate-in">
        <ion-icon name="document-text-outline"></ion-icon>
        <h3>Nenhum checklist simples encontrado</h3>
        <p>Ajuste os filtros ou verifique a conex√£o com o servidor.</p>
      </div>

      <!-- Lista vazia - Completo -->
      <div
        *ngIf="!carregando && !erro && tipoChecklistSelecionado === 'completo' && checklistsCompletosFiltrados.length === 0"
        class="empty-state animate-in">
        <ion-icon name="document-text-outline"></ion-icon>
        <h3>Nenhum checklist completo encontrado</h3>
        <p>Ajuste os filtros ou verifique a conex√£o com o servidor.</p>
      </div>

      <!-- Lista de Checklists Simples -->
      <ion-list class="animate-in-left"
        *ngIf="!carregando && tipoChecklistSelecionado === 'simples' && checklistsFiltrados.length > 0">
        <ion-item-sliding *ngFor="let checklist of checklistsFiltrados">
          <ion-item button (click)="verDetalhes(checklist)">
            <ion-icon name="car-sport" slot="start" color="primary"></ion-icon>
            <ion-label>
              <h2><strong>{{ checklist.placa }}</strong></h2>
              <p>KM: {{ checklist.km_inicial }} | Combust√≠vel: {{ checklist.nivel_combustivel }}</p>
              <p *ngIf="checklist.usuario_nome"><ion-icon name="person"></ion-icon> Inspetor: {{ checklist.usuario_nome
                }}</p>
              <p class="data-texto">{{ formatarData(checklist.data_realizacao) }}</p>
            </ion-label>
            <ion-badge slot="end" color="primary">ID: {{ checklist.id }}</ion-badge>
          </ion-item>

          <ion-item-options side="end">
            <ion-item-option color="primary" (click)="verDetalhes(checklist)">
              <ion-icon slot="icon-only" name="eye"></ion-icon>
            </ion-item-option>
          </ion-item-options>
        </ion-item-sliding>
      </ion-list>

      <!-- Lista de Checklists Completos -->
      <ion-list class="animate-in-right"
        *ngIf="!carregando && tipoChecklistSelecionado === 'completo' && checklistsCompletosFiltrados.length > 0">
        <ion-item-sliding *ngFor="let checklist of checklistsCompletosFiltrados">
          <ion-item button (click)="verDetalhesCompleto(checklist)">
            <ion-icon name="clipboard" slot="start" color="success"></ion-icon>
            <ion-label>
              <h2><strong>{{ checklist.placa }}</strong></h2>
              <p>KM: {{ checklist.km_inicial }} | Combust√≠vel: {{ checklist.nivel_combustivel }}</p>
              <p *ngIf="checklist.usuario_nome"><ion-icon name="person"></ion-icon> Inspetor: {{ checklist.usuario_nome
                }}</p>
              <p class="data-texto">{{ formatarData(checklist.data_realizacao) }}</p>
            </ion-label>
            <ion-badge slot="end" color="success">ID: {{ checklist.id }}</ion-badge>
          </ion-item>

          <ion-item-options side="end">
            <ion-item-option color="success" (click)="verDetalhesCompleto(checklist)">
              <ion-icon slot="icon-only" name="eye"></ion-icon>
            </ion-item-option>
          </ion-item-options>
        </ion-item-sliding>
      </ion-list>
    </div>

    <!-- ========================================= -->
    <!-- ABA: ANOMALIAS -->
    <!-- ========================================= -->
    <div *ngIf="abaSelecionada === 'anomalias'">
      <ion-card color="danger">
        <ion-card-content>
          <ion-icon name="warning"></ion-icon>
          Ve√≠culos com problemas detectados nos checklists
        </ion-card-content>
      </ion-card>

      <!-- Segmento para alternar entre ativas e finalizadas -->
      <ion-segment [(ngModel)]="tipoAnomalias" (ionChange)="mudarTipoAnomalia()" style="margin-bottom: 20px;">
        <ion-segment-button value="ativas">
          <ion-label>Ativas</ion-label>
          <ion-icon name="alert-circle"></ion-icon>
        </ion-segment-button>
        <ion-segment-button value="finalizadas">
          <ion-label>Finalizadas</ion-label>
          <ion-icon name="checkmark-circle"></ion-icon>
        </ion-segment-button>
      </ion-segment>

      <!-- Loading -->
      <div *ngIf="carregandoAnomalias" class="loading-container">
        <ion-spinner name="crescent" color="danger"></ion-spinner>
        <p>Carregando anomalias...</p>
      </div>

      <!-- Erro -->
      <ion-card *ngIf="erroAnomalias && !carregandoAnomalias" color="danger">
        <ion-card-content>
          <ion-icon name="alert-circle"></ion-icon>
          {{ erroAnomalias }}
        </ion-card-content>
      </ion-card>

      <!-- Lista vazia -->
      <div *ngIf="!carregandoAnomalias && !erroAnomalias && anomalias.length === 0" class="empty-state animate-in">
        <ion-icon name="checkmark-circle-outline" color="success"></ion-icon>
        <h3>Nenhuma anomalia encontrada</h3>
        <p>Todos os ve√≠culos est√£o em bom estado!</p>
      </div>

      <!-- Lista de Anomalias por Placa -->
      <div *ngIf="!carregandoAnomalias && anomalias.length > 0">
        <ion-card *ngFor="let veiculo of anomalias" class="anomalia-card">
          <ion-card-header [style.background]="'linear-gradient(135deg, #eb445a 0%, #c1365d 100%)'">
            <ion-card-title style="color: white; display: flex; align-items: center; justify-content: space-between;">
              <span>
                <ion-icon name="car" style="margin-right: 8px;"></ion-icon>
                {{ veiculo.placa }}
              </span>
              <ion-badge color="light">
                {{ veiculo.total_problemas }} problema{{ veiculo.total_problemas > 1 ? 's' : '' }}
              </ion-badge>
            </ion-card-title>
          </ion-card-header>

          <ion-card-content>
            <!-- Resumo -->
            <div style="margin-bottom: 16px; padding: 12px; background: #f5f5f5; border-radius: 8px;">
              <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                <span><strong>Total de problemas:</strong></span>
                <span>{{ veiculo.total_problemas }}</span>
              </div>
              <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                <span><strong>Inspe√ß√µes com problema:</strong></span>
                <span>{{ veiculo.total_inspecoes_com_problema }}</span>
              </div>
              <div style="display: flex; justify-content: space-between;">
                <span><strong>√öltima inspe√ß√£o:</strong></span>
                <span>{{ formatarData(veiculo.data_ultima_inspecao) }}</span>
              </div>
            </div>

            <!-- Lista de Problemas -->
            <ion-button expand="block" fill="outline" color="danger" (click)="toggleDetalhesAnomalia(veiculo.placa)">
              <ion-icon name="{{ detalhesAnomaliaExpandido[veiculo.placa] ? 'chevron-up' : 'chevron-down' }}"
                slot="start"></ion-icon>
              {{ detalhesAnomaliaExpandido[veiculo.placa] ? 'Ocultar' : 'Ver' }} Detalhes dos Problemas
            </ion-button>

            <ion-list *ngIf="detalhesAnomaliaExpandido[veiculo.placa]">
              <ion-item *ngFor="let anomalia of veiculo.anomalias" lines="full">
                <ion-icon name="alert-circle" slot="start" color="danger"></ion-icon>
                <ion-label class="ion-text-wrap">
                  <h3><strong>{{ anomalia.item }}</strong></h3>
                  <p>
                    <span *ngIf="anomalia.statuses && anomalia.statuses.length > 1">
                      <ion-badge *ngFor="let st of anomalia.statuses" [color]="getCorStatus(st)"
                        style="margin-right: 4px;">{{ st }}</ion-badge>
                    </span>
                    <ion-badge *ngIf="!anomalia.statuses || anomalia.statuses.length === 1"
                      [color]="getCorStatus(anomalia.status)">{{ anomalia.status }}</ion-badge>
                    <span style="margin-left: 8px;">{{ formatarCategoria(anomalia.categoria) }}</span>
                  </p>
                  <p style="font-size: 0.85em; color: var(--ion-color-medium); margin-top: 4px;">
                    <ion-icon name="calendar-outline" style="font-size: 0.9em;"></ion-icon>
                    {{ formatarData(anomalia.data_realizacao) }}
                    <span *ngIf="anomalia.total_ocorrencias && anomalia.total_ocorrencias > 1"
                      style="margin-left: 4px;">
                      <strong>({{ anomalia.total_ocorrencias }} ocorr√™ncias)</strong>
                    </span>
                    <span *ngIf="anomalia.inspecoes_ids && anomalia.inspecoes_ids.length > 1" style="margin-left: 4px;">
                      - {{ anomalia.inspecoes_ids.length }} inspe√ß√µes
                    </span>
                  </p>
                  <p *ngIf="anomalia.usuarios && anomalia.usuarios.length > 0"
                    style="font-size: 0.85em; margin-top: 4px;">
                    <ion-icon name="people-outline"></ion-icon>
                    <span style="font-weight: 500;">{{ formatarUsuarios(anomalia.usuarios) }}</span>
                  </p>

                  <!-- Bot√µes de Aprova√ß√£o (apenas para ativas) -->
                  <div *ngIf="tipoAnomalias === 'ativas'"
                    style="margin-top: 12px; display: flex; gap: 8px; flex-wrap: wrap;">
                    <!-- Pendente: mostra bot√µes Sim/N√£o -->
                    <div *ngIf="!anomalia.status_anomalia || anomalia.status_anomalia === 'pendente'"
                      style="display: flex; flex-direction: column; gap: 8px; width: 100%;">
                      <ion-button expand="block" color="success" (click)="aprovarAnomalia(veiculo.placa, anomalia)">
                        <ion-icon name="checkmark-circle" slot="start"></ion-icon>
                        Aprovar
                      </ion-button>
                      <ion-button expand="block" color="danger" (click)="reprovarAnomalia(veiculo.placa, anomalia)">
                        <ion-icon name="close-circle" slot="start"></ion-icon>
                        Reprovar
                      </ion-button>
                    </div>

                    <!-- Aprovado: mostra bot√£o Finalizar -->
                    <div *ngIf="anomalia.status_anomalia === 'aprovado'" style="width: 100%;">
                      <ion-badge color="success" style="margin-bottom: 8px;">Aprovado</ion-badge>
                      <ion-button size="small" expand="block" color="warning"
                        (click)="finalizarAnomalia(veiculo.placa, anomalia)">
                        <ion-icon name="checkmark-done" slot="start"></ion-icon>
                        Finalizar
                      </ion-button>
                    </div>
                  </div>

                  <!-- Informa√ß√£o de finaliza√ß√£o -->
                  <div *ngIf="tipoAnomalias === 'finalizadas' && anomalia.data_finalizacao" style="margin-top: 8px;">
                    <ion-badge color="medium">Finalizado em {{ formatarData(anomalia.data_finalizacao) }}</ion-badge>
                  </div>

                  <!-- Informa√ß√µes de aprova√ß√£o (aparece tanto em ativas quanto finalizadas) -->
                  <div *ngIf="anomalia.status_anomalia === 'aprovado' || anomalia.status_anomalia === 'finalizado'"
                    style="margin-top: 8px; padding: 8px; background: rgba(0,0,0,0.05); border-radius: 4px; font-size: 0.85em; color: #000;">
                    <div *ngIf="anomalia.data_aprovacao" style="margin-bottom: 4px; color: #000;">
                      <ion-icon name="checkmark-circle" color="success"
                        style="font-size: 14px; vertical-align: middle;"></ion-icon>
                      <strong style="color: #000;">Aprovado em:</strong> {{ formatarData(anomalia.data_aprovacao) }}
                    </div>
                    <div *ngIf="anomalia.usuario_aprovador_nome" style="margin-bottom: 4px; color: #000;">
                      <ion-icon name="person" color="primary"
                        style="font-size: 14px; vertical-align: middle;"></ion-icon>
                      <strong style="color: #000;">Aprovado por:</strong> {{ anomalia.usuario_aprovador_nome }}
                    </div>
                    <div *ngIf="anomalia.observacao" style="margin-top: 4px; color: #000;">
                      <ion-icon name="chatbox" color="medium"
                        style="font-size: 14px; vertical-align: middle;"></ion-icon>
                      <strong style="color: #000;">Observa√ß√£o:</strong> {{ anomalia.observacao }}
                    </div>
                  </div>
                </ion-label>
                <ion-button slot="end" fill="clear" *ngIf="anomalia.foto" (click)="expandirFoto(anomalia.foto)">
                  <ion-icon name="image" color="primary"></ion-icon>
                </ion-button>
              </ion-item>
            </ion-list>
          </ion-card-content>
        </ion-card>
      </div>
    </div>

    <!-- ========================================= -->
    <!-- ABA: M√âTRICAS -->
    <!-- ========================================= -->
    <div *ngIf="abaSelecionada === 'metricas'">
      <ion-card>
        <ion-card-header>
          <ion-card-title>
            <ion-icon name="analytics" color="primary"></ion-icon>
            Dashboard de M√©tricas
          </ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <p style="color: #666;">Vis√£o geral do sistema de inspe√ß√µes</p>
        </ion-card-content>
      </ion-card>

      <!-- Resumo Geral -->
      <ion-row>
        <ion-col size="6" size-md="3">
          <ion-card color="primary">
            <ion-card-content style="text-align: center; padding: 16px;">
              <h2 style="color: white; margin: 8px 0; font-size: 24px;">{{ totalChecklists }}</h2>
              <p style="color: white; margin: 0; font-size: 0.8em;">Checklists</p>
            </ion-card-content>
          </ion-card>
        </ion-col>
        <ion-col size="6" size-md="3">
          <ion-card color="warning">
            <ion-card-content style="text-align: center; padding: 16px;">
              <h2 style="color: white; margin: 8px 0; font-size: 24px;">{{ anomalias.length }}</h2>
              <p style="color: white; margin: 0; font-size: 0.8em;">Ve√≠c. c/ Prob.</p>
            </ion-card-content>
          </ion-card>
        </ion-col>
        <ion-col size="6" size-md="3">
          <ion-card color="success">
            <ion-card-content style="text-align: center; padding: 16px;">
              <h2 style="color: white; margin: 8px 0; font-size: 24px;">{{ checklistsHoje }}</h2>
              <p style="color: white; margin: 0; font-size: 0.8em;">Hoje</p>
            </ion-card-content>
          </ion-card>
        </ion-col>
        <ion-col size="6" size-md="3">
          <ion-card color="tertiary">
            <ion-card-content style="text-align: center; padding: 16px;">
              <h2 style="color: white; margin: 8px 0; font-size: 24px;">{{ checklistsSemana }}</h2>
              <p style="color: white; margin: 0; font-size: 0.8em;">Semana</p>
            </ion-card-content>
          </ion-card>
        </ion-col>
      </ion-row>

      <!-- Seletor de Gr√°ficos -->
      <ion-segment [(ngModel)]="graficoSelecionado" (ionChange)="mudarGrafico($event)" scrollable mode="md"
        class="chart-segment">
        <ion-segment-button value="usuarios">
          <ion-label>Usu√°rios</ion-label>
        </ion-segment-button>
        <ion-segment-button value="veiculos">
          <ion-label>Ve√≠culos</ion-label>
        </ion-segment-button>
        <ion-segment-button value="veiculos_anomalias">
          <ion-label>Veic. c/ Prob.</ion-label>
        </ion-segment-button>
        <ion-segment-button value="tipos_anomalias">
          <ion-label>Tipos</ion-label>
        </ion-segment-button>
        <ion-segment-button value="status_anomalias">
          <ion-label>Status</ion-label>
        </ion-segment-button>
      </ion-segment>

      <!-- Busca -->
      <ion-searchbar placeholder="Filtrar dados do gr√°fico..." [(ngModel)]="termoBuscaGrafico"
        (ionInput)="buscarGrafico($event)" debounce="300" animated></ion-searchbar>

      <!-- Container do Gr√°fico -->
      <ion-card class="chart-card animate-in-up">
        <ion-card-header>
          <ion-card-title class="ion-text-center">{{ getTituloGrafico() }}</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <div class="chart-container"
            style="position: relative; height: 600px; width: 100%; display: flex; justify-content: center; align-items: center;">
            <canvas id="chartCanvas"></canvas>
          </div>
        </ion-card-content>
      </ion-card>

      <!-- Lista de Dados -->
      <ion-card class="animate-in-up" *ngIf="dadosGraficoFiltrados.length > 0">
        <ion-card-header>
          <ion-card-title>Detalhamento ({{ dadosGraficoFiltrados.length }})</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <ion-list>
            <ion-item *ngFor="let item of dadosGraficoFiltrados">
              <ion-avatar slot="start" [style.background]="item.color"
                style="width: 24px; height: 24px; border-radius: 50%; margin-right: 16px;"></ion-avatar>
              <ion-label>
                <h2>{{ item.label }}</h2>
                <p>Quantidade: {{ item.value }}</p>
              </ion-label>
              <ion-badge slot="end" color="medium">{{ item.value }}</ion-badge>
            </ion-item>
          </ion-list>
        </ion-card-content>
      </ion-card>

      <!-- Bot√£o para Atualizar -->
      <ion-card>
        <ion-card-content style="text-align: center;">
          <ion-button expand="block" (click)="mudarAba('metricas')" [disabled]="carregandoMetricas">
            <ion-icon name="refresh" slot="start"></ion-icon>
            Atualizar Gr√°ficos
          </ion-button>
        </ion-card-content>
      </ion-card>


    </div>

    <!-- ========================================= -->
    <!-- ABA: CONFIGURA√á√ÉO DE ITENS -->
    <!-- ========================================= -->
    <div *ngIf="abaSelecionada === 'configuracao'">
      <ion-card color="warning">
        <ion-card-content>
          <ion-icon name="information-circle" color="dark"></ion-icon>
          Configure quais itens devem aparecer na inspe√ß√£o veicular
        </ion-card-content>
      </ion-card>

      <!-- Bot√£o para Adicionar Novo Item -->
      <ion-button expand="block" color="success" (click)="adicionarNovoItem()" [disabled]="carregandoConfig">
        <ion-icon slot="start" name="add-circle"></ion-icon>
        Adicionar Novo Item
      </ion-button>

      <!-- Loading -->
      <div *ngIf="carregandoConfig" class="loading-container">
        <ion-spinner name="crescent" color="primary"></ion-spinner>
        <p>Carregando configura√ß√µes...</p>
      </div>

      <!-- Configura√ß√£o por Categoria - SIMPLES -->
      <div *ngIf="!carregandoConfig && tipoChecklistSelecionado === 'simples'">
        <ion-card *ngFor="let categoria of categorias">
          <ion-card-header
            [style.background]="'linear-gradient(135deg, ' + categoria.color + ' 0%, ' + categoria.color + 'dd 100%)'">
            <ion-card-title>
              <ion-icon [name]="categoria.icon"></ion-icon>
              {{ categoria.label }}
              <ion-badge>
                {{ itensConfigPorCategoria[categoria.key]?.length || 0 }}
              </ion-badge>
            </ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <ion-list>
              <ion-item-sliding *ngFor="let item of itensConfigPorCategoria[categoria.key]">
                <ion-item>
                  <ion-label>
                    <h3>{{ item.nome_item }}</h3>
                    <p *ngIf="item.usuario_nome" class="usuario-info">
                      <ion-icon name="person-outline"></ion-icon>
                      Adicionado por: {{ item.usuario_nome }}
                    </p>
                  </ion-label>
                  <ion-toggle slot="end" [checked]="item.habilitado" (ionChange)="toggleItem(item)"
                    [color]="item.habilitado ? 'success' : 'danger'"></ion-toggle>
                </ion-item>

                <!-- Op√ß√£o de deslizar para remover -->
                <ion-item-options side="end">
                  <ion-item-option color="danger" (click)="removerItem(item)">
                    <ion-icon slot="icon-only" name="trash"></ion-icon>
                  </ion-item-option>
                </ion-item-options>
              </ion-item-sliding>
            </ion-list>

            <!-- Mensagem se n√£o houver itens -->
            <div *ngIf="!itensConfigPorCategoria[categoria.key] || itensConfigPorCategoria[categoria.key].length === 0"
              class="empty-state-small">
              <ion-icon [name]="categoria.icon"></ion-icon>
              <p>Nenhum item cadastrado nesta categoria</p>
            </div>
          </ion-card-content>
        </ion-card>
      </div>

      <!-- Configura√ß√£o por Categoria - COMPLETO -->
      <div *ngIf="!carregandoConfig && tipoChecklistSelecionado === 'completo'">
        <ion-card *ngFor="let categoria of categoriasCompleto">
          <ion-card-header
            [style.background]="'linear-gradient(135deg, ' + categoria.color + ' 0%, ' + categoria.color + 'dd 100%)'">
            <ion-card-title>
              <ion-icon [name]="categoria.icon"></ion-icon>
              {{ categoria.label }}
              <ion-badge>
                {{ itensConfigCompletoPorCategoria[categoria.key]?.length || 0 }}
              </ion-badge>
            </ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <ion-list>
              <ion-item-sliding *ngFor="let item of itensConfigCompletoPorCategoria[categoria.key]">
                <ion-item>
                  <ion-label>
                    <h3>{{ item.nome_item }}</h3>
                    <p *ngIf="item.usuario_nome" class="usuario-info">
                      <ion-icon name="person-outline"></ion-icon>
                      Adicionado por: {{ item.usuario_nome }}
                    </p>
                  </ion-label>
                  <ion-toggle slot="end" [checked]="item.habilitado" (ionChange)="toggleItemCompleto(item)"
                    [color]="item.habilitado ? 'success' : 'danger'"></ion-toggle>
                </ion-item>

                <!-- Op√ß√£o de deslizar para remover -->
                <ion-item-options side="end">
                  <ion-item-option color="danger" (click)="removerItem(item)">
                    <ion-icon slot="icon-only" name="trash"></ion-icon>
                  </ion-item-option>
                </ion-item-options>
              </ion-item-sliding>
            </ion-list>

            <!-- Mensagem se n√£o houver itens -->
            <div
              *ngIf="!itensConfigCompletoPorCategoria[categoria.key] || itensConfigCompletoPorCategoria[categoria.key].length === 0"
              class="empty-state-small">
              <ion-icon [name]="categoria.icon"></ion-icon>
              <p>Nenhum item cadastrado nesta categoria</p>
            </div>
          </ion-card-content>
        </ion-card>
      </div>
    </div>
  </div>
</ion-content>

<!-- Modal de Detalhes -->
<ion-modal [isOpen]="mostrarModal" (didDismiss)="fecharModal()">
  <ng-template>
    <ion-header>
      <ion-toolbar color="primary">
        <ion-title>Detalhes do Checklist</ion-title>
        <ion-buttons slot="end">
          <ion-button (click)="fecharModal()">
            <ion-icon name="close"></ion-icon>
          </ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>

    <ion-content *ngIf="checklistDetalhado">
      <div class="detalhes-container">
        <!-- Informa√ß√µes B√°sicas -->
        <ion-card class="info-card">
          <ion-card-header>
            <ion-card-title>
              <ion-icon name="information-circle"></ion-icon>
              Informa√ß√µes do Ve√≠culo
            </ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <div class="info-grid">
              <div class="info-item">
                <ion-icon name="finger-print" color="medium"></ion-icon>
                <div class="info-content">
                  <span class="info-label">ID</span>
                  <span class="info-value">#{{ checklistDetalhado.id }}</span>
                </div>
              </div>

              <div class="info-item">
                <ion-icon name="car" color="primary"></ion-icon>
                <div class="info-content">
                  <span class="info-label">Placa</span>
                  <span class="info-value">{{ checklistDetalhado.placa }}</span>
                </div>
              </div>

              <div class="info-item">
                <ion-icon name="speedometer" color="warning"></ion-icon>
                <div class="info-content">
                  <span class="info-label">Quilometragem</span>
                  <span class="info-value">{{ checklistDetalhado.km_inicial }} km</span>
                </div>
              </div>

              <div class="info-item">
                <ion-icon name="water" color="tertiary"></ion-icon>
                <div class="info-content">
                  <span class="info-label">Combust√≠vel</span>
                  <span class="info-value">{{ checklistDetalhado.nivel_combustivel }}</span>
                </div>
              </div>

              <div class="info-item">
                <ion-icon name="calendar" color="success"></ion-icon>
                <div class="info-content">
                  <span class="info-label">Data/Hora</span>
                  <span class="info-value">{{ formatarData(checklistDetalhado.data_realizacao) }}</span>
                </div>
              </div>

              <div class="info-item" *ngIf="checklistDetalhado.usuario">
                <ion-icon name="person" color="secondary"></ion-icon>
                <div class="info-content">
                  <span class="info-label">Inspetor</span>
                  <span class="info-value">{{ checklistDetalhado.usuario.nome }}</span>
                </div>
              </div>
            </div>

            <div class="observacao-section" *ngIf="checklistDetalhado.observacao_painel">
              <ion-chip color="warning">
                <ion-icon name="chatbox-ellipses"></ion-icon>
                <ion-label>Observa√ß√£o do Painel</ion-label>
              </ion-chip>
              <p class="observacao-text">{{ checklistDetalhado.observacao_painel }}</p>
            </div>
          </ion-card-content>
        </ion-card>

        <!-- Tempo de Telas -->
        <ion-card *ngIf="temposTelas && temposTelas.length > 0">
          <ion-card-header>
            <ion-card-title>Tempo de Telas</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <ion-list>
              <ion-item *ngFor="let tempo of temposTelas">
                <ion-icon name="time-outline" slot="start" color="primary"></ion-icon>
                <ion-label>
                  <h3>{{ getNomeTela(tempo.tela) }}</h3>
                  <p>Tempo: <strong>{{ formatarTempo(tempo.tempo_segundos) }}</strong></p>
                  <p class="ion-text-wrap" style="font-size: 0.85em; color: var(--ion-color-medium);">
                    In√≠cio: {{ formatarData(tempo.data_hora_inicio) }}<br>
                    Fim: {{ formatarData(tempo.data_hora_fim) }}
                  </p>
                </ion-label>
              </ion-item>
            </ion-list>
            <ion-item lines="none">
              <ion-label>
                <h2><strong>Tempo Total:</strong> {{ getTotalTempo() }}</h2>
              </ion-label>
            </ion-item>
          </ion-card-content>
        </ion-card>

        <!-- Foto do Painel e Observa√ß√£o -->
        <ion-card>
          <ion-card-header>
            <ion-card-title>Painel do Ve√≠culo</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <div class="foto-item" *ngIf="checklistDetalhado.fotos?.PAINEL">
              <h4>Foto do Painel</h4>
              <img [src]="checklistDetalhado.fotos.PAINEL" alt="Painel"
                (click)="expandirFoto(checklistDetalhado.fotos.PAINEL)" />
            </div>
            <ion-item *ngIf="checklistDetalhado.observacao_painel">
              <ion-label class="ion-text-wrap">
                <h3>Observa√ß√µes do Painel:</h3>
                <p>{{ checklistDetalhado.observacao_painel }}</p>
              </ion-label>
            </ion-item>
          </ion-card-content>
        </ion-card>

        <!-- Inspe√ß√£o do Motor -->
        <ion-card *ngIf="checklistDetalhado.itens?.MOTOR && checklistDetalhado.itens.MOTOR.length > 0">
          <ion-card-header>
            <ion-card-title>Inspe√ß√£o do Motor</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <ion-list>
              <div *ngFor="let item of checklistDetalhado.itens.MOTOR">
                <ion-item>
                  <ion-label>
                    <h3>{{ item.item }}</h3>
                    <p><ion-badge [color]="getCorStatus(item.status)">{{ item.status || 'N/A' }}</ion-badge></p>
                  </ion-label>
                </ion-item>
                <div class="foto-item" *ngIf="item.foto">
                  <img [src]="item.foto" [alt]="item.item" (click)="expandirFoto(item.foto)" />
                </div>
              </div>
            </ion-list>
          </ion-card-content>
        </ion-card>

        <!-- Inspe√ß√£o El√©trica -->
        <ion-card *ngIf="checklistDetalhado.itens?.ELETRICO && checklistDetalhado.itens.ELETRICO.length > 0">
          <ion-card-header>
            <ion-card-title>Sistema El√©trico</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <ion-list>
              <div *ngFor="let item of checklistDetalhado.itens.ELETRICO">
                <ion-item>
                  <ion-label>
                    <h3>{{ item.item }}</h3>
                    <p><ion-badge [color]="getCorStatus(item.status)">{{ item.status || 'N/A' }}</ion-badge></p>
                  </ion-label>
                </ion-item>
                <div class="foto-item" *ngIf="item.foto">
                  <img [src]="item.foto" [alt]="item.item" (click)="expandirFoto(item.foto)" />
                </div>
              </div>
            </ion-list>
          </ion-card-content>
        </ion-card>

        <!-- Limpeza -->
        <ion-card *ngIf="checklistDetalhado.itens?.LIMPEZA && checklistDetalhado.itens.LIMPEZA.length > 0">
          <ion-card-header>
            <ion-card-title>Limpeza</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <ion-list>
              <div *ngFor="let item of checklistDetalhado.itens.LIMPEZA">
                <ion-item>
                  <ion-label>
                    <h3>{{ item.item }}</h3>
                    <p><ion-badge [color]="getCorStatus(item.status)">{{ item.status || 'N/A' }}</ion-badge></p>
                  </ion-label>
                </ion-item>
                <div class="foto-item" *ngIf="item.foto">
                  <img [src]="item.foto" [alt]="item.item" (click)="expandirFoto(item.foto)" />
                </div>
              </div>
            </ion-list>
          </ion-card-content>
        </ion-card>

        <!-- Ferramentas -->
        <ion-card *ngIf="checklistDetalhado.itens?.FERRAMENTA && checklistDetalhado.itens.FERRAMENTA.length > 0">
          <ion-card-header>
            <ion-card-title>Ferramentas e Equipamentos</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <ion-list>
              <div *ngFor="let item of checklistDetalhado.itens.FERRAMENTA">
                <ion-item>
                  <ion-label>
                    <h3>{{ item.item }}</h3>
                    <p><ion-badge [color]="item.status === 'contem' ? 'success' : 'danger'">{{ item.status === 'contem'
                        ? 'Cont√©m' : 'N√£o Cont√©m' }}</ion-badge></p>
                  </ion-label>
                </ion-item>
                <div class="foto-item" *ngIf="item.foto">
                  <img [src]="item.foto" [alt]="item.item" (click)="expandirFoto(item.foto)" />
                </div>
              </div>
            </ion-list>
          </ion-card-content>
        </ion-card>

        <!-- Fotos do Ve√≠culo -->
        <ion-card *ngIf="checklistDetalhado.fotos">
          <ion-card-header>
            <ion-card-title>Fotos do Ve√≠culo</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <div class="foto-grid">
              <div class="foto-item" *ngIf="checklistDetalhado.fotos.FRONTAL">
                <h4>Foto Frontal</h4>
                <img [src]="checklistDetalhado.fotos.FRONTAL" alt="Frontal"
                  (click)="expandirFoto(checklistDetalhado.fotos.FRONTAL)" />
              </div>
              <div class="foto-item" *ngIf="checklistDetalhado.fotos.TRASEIRA">
                <h4>Foto Traseira</h4>
                <img [src]="checklistDetalhado.fotos.TRASEIRA" alt="Traseira"
                  (click)="expandirFoto(checklistDetalhado.fotos.TRASEIRA)" />
              </div>
              <div class="foto-item" *ngIf="checklistDetalhado.fotos.LATERAL_DIREITA">
                <h4>Foto Lateral Direita</h4>
                <img [src]="checklistDetalhado.fotos.LATERAL_DIREITA" alt="Lateral Direita"
                  (click)="expandirFoto(checklistDetalhado.fotos.LATERAL_DIREITA)" />
              </div>
              <div class="foto-item" *ngIf="checklistDetalhado.fotos.LATERAL_ESQUERDA">
                <h4>Foto Lateral Esquerda</h4>
                <img [src]="checklistDetalhado.fotos.LATERAL_ESQUERDA" alt="Lateral Esquerda"
                  (click)="expandirFoto(checklistDetalhado.fotos.LATERAL_ESQUERDA)" />
              </div>
            </div>
          </ion-card-content>
        </ion-card>

        <!-- Pneus -->
        <ion-card *ngIf="checklistDetalhado.itens?.PNEU && checklistDetalhado.itens.PNEU.length > 0">
          <ion-card-header>
            <ion-card-title>Pneus</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <ion-list>
              <div *ngFor="let item of checklistDetalhado.itens.PNEU">
                <ion-item>
                  <ion-label>
                    <h3>{{ item.item }}</h3>
                    <p><ion-badge [color]="getCorStatus(item.status)">{{ item.status || 'N/A' }}</ion-badge></p>
                    <p *ngIf="item.pressao"><strong>Press√£o:</strong> {{ item.pressao }} PSI</p>
                  </ion-label>
                </ion-item>
                <div class="foto-item" *ngIf="item.foto">
                  <h4>Foto do Pneu</h4>
                  <img [src]="item.foto" [alt]="item.item" (click)="expandirFoto(item.foto)" />
                </div>
              </div>
            </ion-list>
          </ion-card-content>
        </ion-card>
      </div>
    </ion-content>
  </ng-template>
</ion-modal>

<!-- Modal para expans√£o de foto -->
<ion-modal [isOpen]="mostrarFotoExpandida" (didDismiss)="fecharFotoExpandida()">
  <ng-template>
    <ion-header>
      <ion-toolbar color="dark">
        <ion-title>Foto - Zoom {{ zoomLevel }}x</ion-title>
        <ion-buttons slot="start">
          <ion-button (click)="resetZoom()" [disabled]="zoomLevel === 1">
            <ion-icon name="contract-outline"></ion-icon>
          </ion-button>
        </ion-buttons>
        <ion-buttons slot="end">
          <ion-button (click)="zoomOut()" [disabled]="zoomLevel <= 0.5">
            <ion-icon name="remove-circle-outline"></ion-icon>
          </ion-button>
          <ion-button (click)="zoomIn()" [disabled]="zoomLevel >= 5">
            <ion-icon name="add-circle-outline"></ion-icon>
          </ion-button>
          <ion-button (click)="fecharFotoExpandida()">
            <ion-icon name="close"></ion-icon>
          </ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>
    <ion-content class="foto-expandida-content">
      <div class="foto-expandida-container">
        <img [src]="fotoExpandida" alt="Foto Expandida" class="foto-expandida"
          [style.transform]="'scale(' + zoomLevel + ')'" />
      </div>

      <!-- Controles de zoom flutuantes -->
      <div class="zoom-controls">
        <ion-fab-button size="small" color="light" (click)="zoomOut()" [disabled]="zoomLevel <= 0.5">
          <ion-icon name="remove"></ion-icon>
        </ion-fab-button>
        <ion-chip color="light">
          <ion-label>{{ zoomLevel }}x</ion-label>
        </ion-chip>
        <ion-fab-button size="small" color="light" (click)="zoomIn()" [disabled]="zoomLevel >= 5">
          <ion-icon name="add"></ion-icon>
        </ion-fab-button>
      </div>
    </ion-content>
  </ng-template>
</ion-modal>

<!-- Modal de Teste de Foto - Compara√ß√£o Lado a Lado -->
<ion-modal [isOpen]="!!fotoOriginalTeste" (didDismiss)="fecharFotoTeste()">
  <ng-template>
    <ion-header>
      <ion-toolbar color="tertiary">
        <ion-title>Compara√ß√£o de Qualidade</ion-title>
        <ion-buttons slot="end">
          <ion-button (click)="fecharFotoTeste()">
            <ion-icon name="close"></ion-icon>
          </ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>
    <ion-content class="ion-padding">
      <div style="margin-bottom: 16px; text-align: center;">
        <ion-chip color="primary">
          <ion-icon name="information-circle"></ion-icon>
          <ion-label>Toque nas imagens para dar zoom</ion-label>
        </ion-chip>
      </div>

      <!-- Compara√ß√£o Lado a Lado - Desktop/Tablet -->
      <div class="comparacao-container desktop-view">
        <!-- Foto Original -->
        <div class="foto-comparacao">
          <div class="foto-header">
            <h3>üì∏ Original (100%)</h3>
            <p>{{ tamanhoOriginalTeste }}</p>
          </div>
          <div class="foto-wrapper" (click)="expandirFoto(fotoOriginalTeste!)">
            <img [src]="fotoOriginalTeste" alt="Foto Original" />
          </div>
        </div>

        <!-- Foto Comprimida -->
        <div class="foto-comparacao">
          <div class="foto-header">
            <h3>üóúÔ∏è Comprimida (60%)</h3>
            <p>{{ tamanhoComprimidoTeste }}</p>
          </div>
          <div class="foto-wrapper" (click)="expandirFoto(fotoComprimidaTeste!)">
            <img [src]="fotoComprimidaTeste" alt="Foto Comprimida" />
          </div>
        </div>
      </div>

      <!-- Compara√ß√£o Empilhada - Mobile -->
      <div class="comparacao-container mobile-view">
        <!-- Foto Original -->
        <div class="foto-comparacao-mobile">
          <div class="foto-header">
            <h3>üì∏ Original (100%)</h3>
            <p>{{ tamanhoOriginalTeste }}</p>
          </div>
          <div class="foto-wrapper" (click)="expandirFoto(fotoOriginalTeste!)">
            <img [src]="fotoOriginalTeste" alt="Foto Original" />
          </div>
        </div>

        <!-- Foto Comprimida -->
        <div class="foto-comparacao-mobile">
          <div class="foto-header">
            <h3>üóúÔ∏è Comprimida (60%)</h3>
            <p>{{ tamanhoComprimidoTeste }}</p>
          </div>
          <div class="foto-wrapper" (click)="expandirFoto(fotoComprimidaTeste!)">
            <img [src]="fotoComprimidaTeste" alt="Foto Comprimida" />
          </div>
        </div>
      </div>

      <!-- Estat√≠sticas -->
      <ion-card color="success">
        <ion-card-content>
          <div style="text-align: center;">
            <h2 style="margin: 0 0 8px 0; font-size: 32px; font-weight: bold;">{{ reducaoPercentualTeste }}%</h2>
            <p style="margin: 0; font-size: 16px;">de redu√ß√£o no tamanho</p>
          </div>
        </ion-card-content>
      </ion-card>
    </ion-content>
  </ng-template>
</ion-modal>

<!-- Modal de Teste de M√∫ltiplas Qualidades -->
<ion-modal [isOpen]="mostrarModalTestes" (didDismiss)="fecharModalTestes()">
  <ng-template>
    <ion-header>
      <ion-toolbar color="tertiary">
        <ion-title>Teste de Qualidade - 10% a 100%</ion-title>
        <ion-buttons slot="end">
          <ion-button (click)="fecharModalTestes()">
            <ion-icon name="close"></ion-icon>
          </ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>
    <ion-content class="ion-padding">
      <!-- Foto Original -->
      <ion-card color="primary">
        <ion-card-header>
          <ion-card-title>üì∏ Original (100%)</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <div class="foto-wrapper" (click)="expandirFoto(fotoOriginalTeste!)">
            <img [src]="fotoOriginalTeste" alt="Foto Original" style="width: 100%; border-radius: 8px;" />
          </div>
          <p style="margin-top: 10px; text-align: center; font-weight: bold; font-size: 18px;">
            {{ tamanhoOriginalTeste }}
          </p>
        </ion-card-content>
      </ion-card>

      <!-- Grid de Qualidades -->
      <div class="qualidades-grid">
        <ion-card *ngFor="let teste of testesQualidades" [color]="teste.qualidade === 60 ? 'success' : 'light'">
          <ion-card-header>
            <ion-card-title style="display: flex; align-items: center; justify-content: space-between;">
              <span>{{ teste.qualidade }}%</span>
              <ion-badge [color]="teste.qualidade === 60 ? 'warning' : 'medium'">
                {{ teste.qualidade === 60 ? '‚≠ê Recomendado' : teste.reducao + '% menor' }}
              </ion-badge>
            </ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <div class="foto-wrapper" (click)="expandirFoto(teste.foto)">
              <img [src]="teste.foto" [alt]="'Qualidade ' + teste.qualidade + '%'"
                style="width: 100%; border-radius: 8px;" />
            </div>
            <p style="margin-top: 10px; text-align: center; font-weight: bold;">
              {{ teste.tamanho }}
            </p>
            <p style="margin: 0; text-align: center; color: var(--ion-color-medium); font-size: 14px;">
              Redu√ß√£o: {{ teste.reducao }}%
            </p>
          </ion-card-content>
        </ion-card>
      </div>

      <!-- Informa√ß√£o -->
      <ion-card color="warning">
        <ion-card-content>
          <p style="margin: 0; text-align: center;">
            <ion-icon name="information-circle"></ion-icon>
            <strong>60%</strong> √© a qualidade recomendada - balanceia tamanho e qualidade visual
          </p>
        </ion-card-content>
      </ion-card>
    </ion-content>
  </ng-template>
</ion-modal>

<!-- Modal de Detalhes do Checklist Completo -->
<ion-modal [isOpen]="mostrarModalCompleto" (didDismiss)="fecharModalCompleto()">
  <ng-template>
    <ion-header>
      <ion-toolbar color="success">
        <ion-title>Checklist Completo - Detalhes</ion-title>
        <ion-buttons slot="end">
          <ion-button (click)="fecharModalCompleto()">
            <ion-icon name="close"></ion-icon>
          </ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>

    <ion-content *ngIf="checklistCompletoDetalhado">
      <div class="detalhes-container">
        <!-- Informa√ß√µes B√°sicas -->
        <ion-card class="info-card">
          <ion-card-header>
            <ion-card-title>
              <ion-icon name="information-circle"></ion-icon>
              Informa√ß√µes B√°sicas
            </ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <div class="info-grid">
              <div class="info-item">
                <ion-icon name="finger-print" color="medium"></ion-icon>
                <div class="info-content">
                  <span class="info-label">ID</span>
                  <span class="info-value">#{{ checklistCompletoDetalhado.id }}</span>
                </div>
              </div>

              <div class="info-item">
                <ion-icon name="car" color="success"></ion-icon>
                <div class="info-content">
                  <span class="info-label">Placa</span>
                  <span class="info-value">{{ checklistCompletoDetalhado.placa }}</span>
                </div>
              </div>

              <div class="info-item">
                <ion-icon name="speedometer" color="warning"></ion-icon>
                <div class="info-content">
                  <span class="info-label">Quilometragem</span>
                  <span class="info-value">{{ checklistCompletoDetalhado.km_inicial }} km</span>
                </div>
              </div>

              <div class="info-item">
                <ion-icon name="water" color="tertiary"></ion-icon>
                <div class="info-content">
                  <span class="info-label">Combust√≠vel</span>
                  <span class="info-value">{{ checklistCompletoDetalhado.nivel_combustivel }}</span>
                </div>
              </div>

              <div class="info-item">
                <ion-icon name="calendar" color="success"></ion-icon>
                <div class="info-content">
                  <span class="info-label">Data/Hora</span>
                  <span class="info-value">{{ formatarData(checklistCompletoDetalhado.data_realizacao) }}</span>
                </div>
              </div>

              <div class="info-item" *ngIf="checklistCompletoDetalhado.usuario_nome">
                <ion-icon name="person" color="secondary"></ion-icon>
                <div class="info-content">
                  <span class="info-label">Inspetor</span>
                  <span class="info-value">{{ checklistCompletoDetalhado.usuario_nome }}</span>
                </div>
              </div>
            </div>

            <div class="observacao-section" *ngIf="checklistCompletoDetalhado.observacao_painel">
              <ion-chip color="warning">
                <ion-icon name="chatbox-ellipses"></ion-icon>
                <ion-label>Observa√ß√£o do Painel</ion-label>
              </ion-chip>
              <p class="observacao-text">{{ checklistCompletoDetalhado.observacao_painel }}</p>
            </div>
          </ion-card-content>
        </ion-card>

        <!-- Foto do Painel -->
        <ion-card *ngIf="checklistCompletoDetalhado.foto_painel">
          <ion-card-header>
            <ion-card-title>Foto do Painel</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <div class="foto-item">
              <img [src]="checklistCompletoDetalhado.foto_painel" alt="Painel"
                (click)="expandirFoto(checklistCompletoDetalhado.foto_painel)" />
            </div>
          </ion-card-content>
        </ion-card>

        <!-- Parte 1 - Interna -->
        <ion-card *ngIf="checklistCompletoDetalhado.parte1">
          <ion-card-header>
            <ion-card-title>Parte 1 - Itens Internos</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <ion-list>
              <ion-item *ngFor="let key of getObjectKeys(checklistCompletoDetalhado.parte1)">
                <ion-label>
                  <h3>{{ formatarNomeCampo(key) }}</h3>
                  <p>{{ formatarValor(checklistCompletoDetalhado.parte1[key]) }}</p>
                </ion-label>
              </ion-item>
            </ion-list>
          </ion-card-content>
        </ion-card>

        <!-- Parte 2 - Equipamentos -->
        <ion-card *ngIf="checklistCompletoDetalhado.parte2">
          <ion-card-header>
            <ion-card-title>Parte 2 - Equipamentos Obrigat√≥rios</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <ion-list>
              <ion-item *ngFor="let key of getObjectKeys(checklistCompletoDetalhado.parte2)">
                <ion-label>
                  <h3>{{ formatarNomeCampo(key) }}</h3>
                  <p>{{ formatarValor(checklistCompletoDetalhado.parte2[key]) }}</p>
                </ion-label>
              </ion-item>
            </ion-list>
          </ion-card-content>
        </ion-card>

        <!-- Parte 3 - Dianteira -->
        <ion-card *ngIf="checklistCompletoDetalhado.parte3">
          <ion-card-header>
            <ion-card-title>Parte 3 - Externa Dianteira</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <ion-list>
              <ion-item *ngFor="let key of getObjectKeys(checklistCompletoDetalhado.parte3)">
                <ion-label>
                  <h3>{{ formatarNomeCampo(key) }}</h3>
                  <p>{{ formatarValor(checklistCompletoDetalhado.parte3[key]) }}</p>
                </ion-label>
              </ion-item>
            </ion-list>
          </ion-card-content>
        </ion-card>

        <!-- Parte 4 - Traseira -->
        <ion-card *ngIf="checklistCompletoDetalhado.parte4">
          <ion-card-header>
            <ion-card-title>Parte 4 - Externa Traseira</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <ion-list>
              <ion-item *ngFor="let key of getObjectKeys(checklistCompletoDetalhado.parte4)">
                <ion-label>
                  <h3>{{ formatarNomeCampo(key) }}</h3>
                  <p>{{ formatarValor(checklistCompletoDetalhado.parte4[key]) }}</p>
                </ion-label>
              </ion-item>
            </ion-list>
          </ion-card-content>
        </ion-card>

        <!-- Parte 5 - Especial -->
        <ion-card *ngIf="checklistCompletoDetalhado.parte5">
          <ion-card-header>
            <ion-card-title>Parte 5 - √înibus/Caminh√µes/Carro Tanque</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <ion-list>
              <ion-item *ngFor="let key of getObjectKeys(checklistCompletoDetalhado.parte5)">
                <ion-label>
                  <h3>{{ formatarNomeCampo(key) }}</h3>
                  <p>{{ formatarValor(checklistCompletoDetalhado.parte5[key]) }}</p>
                </ion-label>
              </ion-item>
            </ion-list>
          </ion-card-content>
        </ion-card>
      </div>
    </ion-content>
  </ng-template>
</ion-modal>